<!DOCTYPE html>
<!-- ondoca qie el document és HTML5 -->
<html>
<head>
<!-- la seccio head conté metadades i enllaços a fitxers externs-->

  <meta charste="UFT-8">
  <!-- Defineiz la codificació de caràcters a UFT-8, que suporta els accents i simbols especials -->

  <title>Art Geometric amd Mini Cara i Text Gran</title>
<!-- Definrix el títol de la pa`gina que apereixerà a la pestanya del navegador -->

  <!--Llibreries necessàries: s'iclouen des de servidors externs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.11.3/p5.js"></script>
  <!-- Aquesta és la biblioteca p5.js, que facilita la creació de gràfics i animacions en el navegador -->

  <script src="https://cnd.jdselivr.net/gh/ml5js/Intro.ML-Arts-IMA@ml5-build-10-7-19/ml5_build/ml5.min.js2"></script>
  <!--Aquesta és la biblioteca p5.js, que ens permet utilitzar models d'intel·ligència artificial com la detecció facial -->

  <style>
    /* Inici del codi CSS per donar estil a la pàgina */

    body{
    margin: 0;
    padding: 0;
    background-color: #f4f4f4;
      /* Fons de color gris clar */
    display: flex;
    flex-direction: column;
    align-items: center;
    /* La pàgina està centrada i es distribueixen els elements en columna */
    }

    /* Estils per a la pantalla de càrrega que es mostra abans que es carreguin els models */
    #loading-screen {
    position: fixed;
      /* La pantalla de càrrega es manté fixa en tot moment a la finestra del navegador */

top: 0; 
left: 0;
width: 100%;
height: 100%;
background: rgba(255,255,255,0.9);
/*Fons blanc amb lleugera transparència*/
display: flex;
flex-direction: column;
justify-content: center;
align-items: center;
/*Centra el contingut de la pantalla (loader i text)*/
font-family: Arial, sans-serif;
font-size: 18px;
color: #333;
/*Text en gris fosc per a bona llegibilitat*/
z-index: 10;
/*Es col·loca per sobre de tot el contingut (amb un índex z alt)*/
}

.loader {
width: 50px:
height: 50px:
border: 6px solid #3498db;
/*Marge de 6 píxels de grosor amb color blau (part de la vora)*/
border-top: 6px solid transparent;
/*La part superior és transparent per fer l'efecte giratori*/
border-radius: 50%;
/*Fa el loader circular*/
animation: spin 1s linear infinite;
/*Aplica una animación que fa girar l'element indefinidament*/
margin-bottom: 10px;
}

/*Declaració de la keyframe de l'animació que fa girar l'element loader*/
@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
/*Fi de l'estil CSS*/
</style>
</head>



  video.size(480, 480);
//Es defineix la mida del vídeo
video.hide();
//Amaguem el vídeo perquè només s'utilitzi per processar la imatge, no per mostrar-lo directament

//Opcions per a la detecció facial (configuració del model)
const faceOptions= {
withLandmarks: true, //Detecta els punts clau de la cara (ulls, nas, boca, etc.)
withExpressions: true, //Detecta les expressions facials (felicitat, tristesa, etc.)
withDescriptions: false, //No sol·licita descriptors facials (informació per reconèixer cares)
minConfidence: 0.5 //Nivel mínim de certesa per considerar una detecció vàlida
};

//Inicialitza el model de detecció facial amb el vídeo i les opcios definides 
faceapi= m15.face4Api(video, faceOptions,faceReady);
//Quan el model estigui preparat, es cridarà la funció faceReady
}

//Funció que s'executa quan el model de detecció facial està llest
  function faceReady() {
  faceapi.detect(gotFaces);
  //Inicia la detecció facial cridant la funció gotFaces quan es complementen les deteccions 
  }

  function windowResized() {
  resizeCanvas(windowWidth, windowHeight); //Nova funció per adaptar el canvas 
  }

  //Funció que s'executa cada cop que m15 .js té les deteccions d'una cara 
  function gotFaces(error, result) {
  if (error) {
  console.error(error);
  //En cas d'error, s'imprimeix a la consola i es deté l'execució
  return;
  }

  detections=result;
  //Guarda el resultat de les deteccions (poden ser múltiples cares, però en aquest cas s'utilitza la primera)



  text("Expressió: " +dominant, width/2,50);
  //"width/2" centra el text horitzontalment i "50" és la coordenada vertical

  //Dibuixa una mini imatge de la cara a la part inferior dreta del canvas 
  if(detections && detections.length>0){
  //Es fa servir la imatge del vídeo capturat per representar la cara
  imatge(video,width-miniWidth-20,height-miniHeight-20, miniWidth,miniHeight);
  }
  }

  //Funció per dibuixar art geomètric en funció de l'expressió facial detectada 
  function drawDifferentArt(dominant,intensity){
  push();
  //Guarda l'estat actual de les transformacions gràfiques 

  translate(width/2,height/2);
  //Trasllada l'origen del sistema de coordenades al centre del canvas 

  noFill();
  //Es desactiva al farcit (no es pinta amb color les formes interiors)

  strokeWeight(4);
  //Defineix l'amplada del traç (línia de dibuix) en 4 píxels

  //Utilitza una estructura switch per triar el dibuix en funció del sentiment detectat 
  switch (dominant) {
  case "happy":
  
  
